<div class="container">
  <div class="section">
    <div class="row">

      <div class="col s12 m12">
        <div class="card-panel grey lighten-5">
          <h4 class="center brown-text title"></h4>
          <h5 class="black-text company">Company name: </h5>
          <h5>Description: </h5>
          <span class="black-text description">
          </span>

          <h5>Required skill(s): </h5>
          <span class="required-keyskills">
          </span>
          <h5>Not required skill(s): </h5>
          <span class="keyskills">
          </span>
          <br/>
          <br/>
          <div class="modals">
          </div>
          <form action="#">
            <table class="responsive-table">
              <thead>
                <tr>
                  <th data-field="applicant">Applicant</th>
                  <th data-field="Score">Score</th>
                  <th data-field="view">View</th>
                  <th data-field="select_user">Select</th>
                </tr>
              </thead>

              <tbody id="list-applicants">
              </tbody>
            </table>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function($) {
  var url = 'api/job/'+<?php echo $_GET['id'];?>+'/requirements';
  $.ajax({
    type: "GET",
    url: url,
    success: function(data){
      job = data;
      $('.title').html(job.job_title);
      $('.company').html("Company Name: "+job.company_name);
      $('.description').html(job.description);
      job.requirements.forEach(function (e) {
        if (e.is_available === 1) {
          if (e.is_required === 1) {
            $('.required-keyskills').append('<div class="chip light-blue darken-2 white-text">'+e.keyword.keyword+'</div> ');
          } else {
            $('.keyskills').append('<div class="chip light-green darken-2 white-text">'+e.keyword.keyword+'</div> ');
          }

        } 
      });
    },
    error: function(data){
    }
  });

  url = 'api/candidates/<?php echo $_GET["id"];?>';
  $.ajax({
    type: "GET",
    url: url,
    success: function(data){
      candidates = data;
      candidates.forEach(function(candidate) {
        $('#list-applicants').append('<tr><td>'+candidate.user.name+'</td><td>'+candidate.score+'%</td><td><a target="_blank" href="api/resume/'+candidate.id+'/download">View Resume</a><br/><br/><a class="modal-trigger" href="#modal'+candidate.user_id+'">View more details</a></td><td><p><input name="group1" type="checkbox" id="selectapplicant'+candidate.user_id+'" /><label for="selectapplicant'+candidate.user_id+'"></label></p></td></tr>');

        $('.modals').append('<div id="modal'+candidate.user_id+'" class="modal"><div class="modal-content"><h4>Candidate details</h4><p>Name: '+candidate.user.name+'</br>Email: '+candidate.user.email+'</br>Contact Number: '+candidate.contact+'</p><h5>Skillset: </h5><span class="skills'+candidate.user_id+'"></span></div><div class="modal-footer"><a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Close</a></div></div>');

        candidate.resume_keywords.forEach(function (e) {
          $('.skills'+candidate.user_id).append('<div class="chip light-blue darken-2 white-text">'+e.keyword.keyword+'</div> ');
        });

      });
    $('.modal-trigger').leanModal();
    },
    error: function(data){
    }
  });
});

</script>
